<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portland Reuse Hub - Find Where to Donate, Repair & Recycle</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-top">
                <div>
                    <h1>ðŸŒ± Portland Reuse Hub</h1>
                    <p class="tagline">Find where to donate, repair, recycle, or properly dispose of anything in Portland</p>
                </div>
                <div class="header-actions">
                    <button class="suggest-btn" onclick="openSuggestionModal()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="8" x2="12" y2="16"></line>
                            <line x1="8" y1="12" x2="16" y2="12"></line>
                        </svg>
                        <span>Suggest a Location</span>
                    </button>
                    <button class="admin-btn" onclick="openAdminLogin()" title="Admin">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"></path>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1Z"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Suggestion Modal -->
    <div class="modal-overlay" id="suggestionModal">
        <div class="modal">
            <div class="modal-header">
                <h2>Suggest a New Location</h2>
                <button class="modal-close" onclick="closeSuggestionModal()">&times;</button>
            </div>
            <form id="suggestionForm" onsubmit="submitSuggestion(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label for="suggestName">Location Name *</label>
                        <input type="text" id="suggestName" required placeholder="e.g., Green Drop Recycling">
                    </div>
                    <div class="form-group">
                        <label for="suggestType">Type *</label>
                        <select id="suggestType" required>
                            <option value="">Select type...</option>
                            <option value="donation">Donation</option>
                            <option value="repair">Repair</option>
                            <option value="recycling">Recycling</option>
                            <option value="disposal">Disposal</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="suggestAddress">Address *</label>
                    <input type="text" id="suggestAddress" required placeholder="e.g., 123 Main St, Portland, OR 97201">
                </div>
                <div class="form-group">
                    <label for="suggestAccepts">Items Accepted</label>
                    <textarea id="suggestAccepts" rows="2" placeholder="e.g., Electronics, batteries, old computers (comma separated)"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="suggestPhone">Phone Number</label>
                        <input type="tel" id="suggestPhone" placeholder="e.g., (503) 555-1234">
                    </div>
                    <div class="form-group">
                        <label for="suggestWebsite">Website</label>
                        <input type="url" id="suggestWebsite" placeholder="e.g., https://example.com">
                    </div>
                </div>
                <div class="form-group">
                    <label for="suggestHours">Hours of Operation</label>
                    <input type="text" id="suggestHours" placeholder="e.g., Mon-Fri 9am-5pm, Sat 10am-4pm">
                </div>
                <div class="form-group">
                    <label for="suggestDescription">Description</label>
                    <textarea id="suggestDescription" rows="2" placeholder="Brief description of this location..."></textarea>
                </div>
                <div class="form-group">
                    <label for="suggestEmail">Your Email (for follow-up)</label>
                    <input type="email" id="suggestEmail" placeholder="your.email@example.com">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeSuggestionModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Submit Suggestion</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div class="modal-overlay" id="adminLoginModal">
        <div class="modal modal-small">
            <div class="modal-header">
                <h2>Admin Login</h2>
                <button class="modal-close" onclick="closeAdminLogin()">&times;</button>
            </div>
            <form id="adminLoginForm" onsubmit="adminLogin(event)">
                <div class="form-group">
                    <label for="adminPassword">Password</label>
                    <input type="password" id="adminPassword" required placeholder="Enter admin password">
                </div>
                <p class="form-hint" id="adminLoginError" style="color: #c62828; display: none;">Incorrect password</p>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeAdminLogin()">Cancel</button>
                    <button type="submit" class="btn-primary">Login</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div class="modal-overlay" id="adminPanelModal">
        <div class="modal modal-large">
            <div class="modal-header">
                <h2>Admin Panel</h2>
                <button class="modal-close" onclick="closeAdminPanel()">&times;</button>
            </div>
            <div class="admin-tabs">
                <button class="admin-tab active" data-tab="submissions" onclick="switchAdminTab('submissions')">
                    Submissions
                    <span class="tab-badge" id="pendingCountBadge"></span>
                </button>
                <button class="admin-tab" data-tab="insights" onclick="switchAdminTab('insights')">
                    Insights
                </button>
            </div>
            <div class="admin-tab-content" id="submissionsTab">
                <div class="admin-content" id="adminContent">
                    <!-- Submissions will be loaded here -->
                </div>
            </div>
            <div class="admin-tab-content" id="insightsTab" style="display: none;">
                <div class="insights-dashboard" id="insightsDashboard">
                    <!-- Insights will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <main class="container">
        <!-- Search Section -->
        <section class="search-section">
            <div class="search-box">
                <input 
                    type="text" 
                    id="searchInput" 
                    placeholder="What do you want to reuse or recycle? (e.g., laptop, couch, paint)"
                    autocomplete="off"
                >
                <button id="searchBtn">Search</button>
            </div>
        </section>

        <!-- Category Chips -->
        <section class="category-section">
            <div class="category-header">
                <h3>Browse by Category:</h3>
                <button class="clear-categories-btn" id="clearCategoriesBtn" style="display: none;">Clear</button>
            </div>
            <div class="category-chips" id="categoryChips">
                <!-- Chips will be generated by JavaScript -->
            </div>
        </section>

        <!-- Filters -->
        <section class="filters-section">
            <h3>Filter by Type:</h3>
            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="donation">Donation</button>
                <button class="filter-btn" data-filter="repair">Repair</button>
                <button class="filter-btn" data-filter="recycling">Recycling</button>
                <button class="filter-btn" data-filter="disposal">Disposal</button>
                <button class="filter-btn filter-btn-favorites" data-filter="favorites">Favorites</button>
                <button class="clear-favorites-btn" onclick="clearAllFavorites()" title="Clear all favorites">Clear Favorites</button>
            </div>
        </section>

        <!-- Results Grid -->
        <section class="results-section">
            <div class="results-header">
                <h2>Locations <span id="resultCount">(0)</span></h2>
                <div class="results-header-controls">
                    <!-- Mobile View Toggle -->
                    <div class="mobile-view-toggle" id="mobileViewToggle">
                        <button class="view-toggle-btn active" data-view="list" aria-label="List View">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="3" y1="6" x2="21" y2="6"></line>
                                <line x1="3" y1="12" x2="21" y2="12"></line>
                                <line x1="3" y1="18" x2="21" y2="18"></line>
                            </svg>
                            <span>List</span>
                        </button>
                        <button class="view-toggle-btn" data-view="map" aria-label="Map View">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon>
                                <line x1="8" y1="2" x2="8" y2="18"></line>
                                <line x1="16" y1="6" x2="16" y2="22"></line>
                            </svg>
                            <span>Map</span>
                        </button>
                    </div>
                    <!-- Share Search Results -->
                    <div class="share-results-wrapper">
                        <button class="share-results-btn" onclick="toggleSearchShareMenu(event)" title="Share these results">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="18" cy="5" r="3"></circle>
                                <circle cx="6" cy="12" r="3"></circle>
                                <circle cx="18" cy="19" r="3"></circle>
                                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                            </svg>
                            <span>Share Results</span>
                        </button>
                        <div class="share-menu" id="searchShareMenu">
                            <button class="share-menu-item" onclick="shareSearchResults('copy', event)">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                </svg>
                                Copy Link
                            </button>
                            <button class="share-menu-item" onclick="shareSearchResults('email', event)">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                                    <polyline points="22,6 12,13 2,6"></polyline>
                                </svg>
                                Email
                            </button>
                            <button class="share-menu-item" onclick="shareSearchResults('twitter', event)">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                                </svg>
                                Twitter/X
                            </button>
                        </div>
                    </div>
                    <!-- Export Options -->
                    <div class="export-wrapper">
                        <button class="export-btn" onclick="toggleExportMenu(event)" title="Export results">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            <span>Export</span>
                        </button>
                        <div class="share-menu" id="exportMenu">
                            <button class="share-menu-item" onclick="printSearchResults()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 6 2 18 2 18 9"></polyline>
                                    <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                                    <rect x="6" y="14" width="12" height="8"></rect>
                                </svg>
                                Print Results
                            </button>
                            <button class="share-menu-item" onclick="exportToCSV()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                    <polyline points="10 9 9 9 8 9"></polyline>
                                </svg>
                                Export to CSV
                            </button>
                            <button class="share-menu-item" onclick="saveAsPDF()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <path d="M9 15v-2h6v2"></path>
                                    <path d="M12 13v5"></path>
                                </svg>
                                Save as PDF
                            </button>
                            <button class="share-menu-item" onclick="emailLocations()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                                    <polyline points="22,6 12,13 2,6"></polyline>
                                </svg>
                                Email Me These
                            </button>
                        </div>
                    </div>
                    <select id="sortSelect">
                        <option value="name">Sort by Name</option>
                        <option value="distance">Sort by Distance</option>
                        <option value="type">Sort by Type</option>
                    </select>
                </div>
            </div>

            <div class="content-grid" id="contentGrid">
                <!-- Results List -->
                <div class="results-list" id="resultsList">
                    <p class="no-results">Search for an item or browse all locations below</p>
                </div>

                <!-- Map -->
                <div class="map-container" id="mapContainer">
                    <button class="reset-map-btn" id="resetMapBtn" title="Reset Map View">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                            <path d="M3 3v5h5"></path>
                        </svg>
                        <span>Reset View</span>
                    </button>
                    <div class="map-legend">
                        <div class="legend-title">Marker Types</div>
                        <div class="legend-item"><span class="legend-color" style="background: #2d6a4f;"></span> Donation</div>
                        <div class="legend-item"><span class="legend-color" style="background: #1976d2;"></span> Repair</div>
                        <div class="legend-item"><span class="legend-color" style="background: #f57c00;"></span> Recycling</div>
                        <div class="legend-item"><span class="legend-color" style="background: #c62828;"></span> Disposal</div>
                    </div>
                    <div id="map"></div>
                </div>
            </div>

            <!-- Swipe indicator for mobile -->
            <div class="swipe-indicator" id="swipeIndicator">
                <span class="swipe-dot active"></span>
                <span class="swipe-dot"></span>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>Portland Reuse Hub - Helping Portland reduce waste through reuse, repair, and recycling</p>
            <p class="disclaimer">Location data is community-sourced. Please verify hours and accepted items before visiting.</p>
        </div>
    </footer>

    <script src="app.js"></script>
</body>
</html>
